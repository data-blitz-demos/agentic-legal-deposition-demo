# Internal Code Artifact and Function Reference

Generated at `2026-02-26T21:20:36+00:00`.

This file is generated by `python scripts/generate_internal_docs.py`.

## Coverage

- Artifacts documented: 18
- Functions documented: 344

## `backend/app/__init__.py`

**Artifact purpose:** Application package: API routes, workflow, LLM integration, and models.

No functions detected in this artifact.

## `backend/app/chat.py`

**Artifact purpose:** No module docstring present; see function-level details below.

| Function | Signature | Description |
| --- | --- | --- |
| `AttorneyChatService.__init__` (`L20`) | `def AttorneyChatService.__init__(self, settings: Settings) -> None` | Initialize default OpenAI chat model and retain settings. |
| `AttorneyChatService.respond` (`L30`) | `def AttorneyChatService.respond(self, deposition: dict, peers: list[dict], user_message: str, history: list[dict], llm_provider: str \| None=None, llm_model: str \| None=None) -> str` | Generate a general attorney response for the selected deposition. |
| `AttorneyChatService.respond_with_trace` (`L51`) | `def AttorneyChatService.respond_with_trace(self, deposition: dict, peers: list[dict], user_message: str, history: list[dict], llm_provider: str \| None=None, llm_model: str \| None=None) -> tuple[str, list[dict]]` | Generate attorney chat response plus visible process trace. |
| `AttorneyChatService.reason_about_contradiction` (`L124`) | `def AttorneyChatService.reason_about_contradiction(self, deposition: dict, peers: list[dict], contradiction: dict, llm_provider: str \| None=None, llm_model: str \| None=None) -> str` | Generate focused reasoning for one contradiction finding. |
| `AttorneyChatService._get_llm` (`L158`) | `def AttorneyChatService._get_llm(self, llm_provider: str \| None, llm_model: str \| None, *, temperature: float)` | Return default model or provider-specific override model. |
| `AttorneyChatService._trace_model_name` (`L170`) | `def AttorneyChatService._trace_model_name(self, requested_model: str \| None) -> str` | Resolve effective model name for trace metadata. |
| `AttorneyChatService._normalize_provider` (`L175`) | `def AttorneyChatService._normalize_provider(self, provider: str \| None)` | Normalize provider string for trace payload typing. |
| `AttorneyChatService._preview_text` (`L181`) | `def AttorneyChatService._preview_text(self, value: str, limit: int) -> str` | Trim large text blocks for UI trace display. |
| `AttorneyChatService._fallback_chat_response` (`L189`) | `def AttorneyChatService._fallback_chat_response(self, deposition: dict, user_message: str) -> str` | Legacy deterministic chat fallback (kept for test and utility use). |
| `AttorneyChatService._fallback_contradiction_reasoning` (`L223`) | `def AttorneyChatService._fallback_contradiction_reasoning(self, contradiction: dict) -> str` | Legacy deterministic contradiction fallback (utility/test coverage). |
| `AttorneyChatService._normalize_reasoning_output` (`L246`) | `def AttorneyChatService._normalize_reasoning_output(self, raw: str, contradiction: dict, context_payload: dict) -> str` | Normalize focused reasoning into a stable, detailed plain-text format. |
| `AttorneyChatService._parse_json_payload` (`L273`) | `def AttorneyChatService._parse_json_payload(self, raw: str) -> dict \| None` | Parse direct JSON or fenced JSON payloads returned by less-consistent models. |
| `AttorneyChatService._contains_placeholder` (`L289`) | `def AttorneyChatService._contains_placeholder(self, raw: str) -> bool` | Detect placeholder/template output that should be replaced with concrete content. |
| `AttorneyChatService._extract_short_answer` (`L297`) | `def AttorneyChatService._extract_short_answer(self, raw: str) -> str` | Extract short-answer line from free-form text responses. |
| `AttorneyChatService._extract_bullets` (`L307`) | `def AttorneyChatService._extract_bullets(self, raw: str) -> list[str]` | Extract bullet-like lines from text responses. |
| `AttorneyChatService._default_reasoning_sections` (`L322`) | `def AttorneyChatService._default_reasoning_sections(self, contradiction: dict, context_payload: dict) -> dict` | Build a detailed deterministic scaffold for focused contradiction explanations. |
| `AttorneyChatService._pick_peer_for_contradiction` (`L367`) | `def AttorneyChatService._pick_peer_for_contradiction(self, context_payload: dict, contradiction: dict) -> dict` | Pick the most relevant peer deposition for this contradiction context. |
| `AttorneyChatService._first_claim_statement` (`L380`) | `def AttorneyChatService._first_claim_statement(self, deposition: dict) -> str` | Extract first claim statement from a deposition payload. |
| `AttorneyChatService._merge_json_reasoning` (`L389`) | `def AttorneyChatService._merge_json_reasoning(self, payload: dict, defaults: dict) -> dict` | Merge JSON-style model output into normalized reasoning sections. |
| `AttorneyChatService._render_reasoning_sections` (`L432`) | `def AttorneyChatService._render_reasoning_sections(self, sections: dict) -> str` | Render normalized focused reasoning sections into one consistent text block. |
| `AttorneyChatService._build_context_payload` (`L460`) | `def AttorneyChatService._build_context_payload(self, deposition: dict, peers: list[dict]) -> dict` | Assemble compact JSON context payload sent to chat prompts. |

## `backend/app/config.py`

**Artifact purpose:** Application configuration loaded from environment variables. This module centralizes runtime settings so all subsystems (API routes, workflow engine, LLM selection, storage) read from one typed source.

| Function | Signature | Description |
| --- | --- | --- |
| `get_settings` (`L48`) | `def get_settings() -> Settings` | Return a cached ``Settings`` instance for the current process. |

## `backend/app/couchdb.py`

**Artifact purpose:** No module docstring present; see function-level details below.

| Function | Signature | Description |
| --- | --- | --- |
| `CouchDBClient.__init__` (`L14`) | `def CouchDBClient.__init__(self, url: str, db_name: str) -> None` | Initialize a persistent HTTP client and DB base URL. |
| `CouchDBClient.close` (`L22`) | `def CouchDBClient.close(self) -> None` | Close the underlying HTTP connection pool. |
| `CouchDBClient.ensure_db` (`L27`) | `def CouchDBClient.ensure_db(self, retries: int=30, delay_seconds: float=1.0) -> None` | Create the target DB if needed, retrying during startup races. |
| `CouchDBClient.save_doc` (`L44`) | `def CouchDBClient.save_doc(self, doc: dict[str, Any]) -> dict[str, Any]` | Insert a new document, or update when ``_id`` already exists. |
| `CouchDBClient.update_doc` (`L57`) | `def CouchDBClient.update_doc(self, doc: dict[str, Any]) -> dict[str, Any]` | Upsert a document by ``_id``, hydrating ``_rev`` when needed. |
| `CouchDBClient.get_doc` (`L77`) | `def CouchDBClient.get_doc(self, doc_id: str) -> dict[str, Any]` | Fetch a single document by id. |
| `CouchDBClient.delete_doc` (`L84`) | `def CouchDBClient.delete_doc(self, doc_id: str, rev: str \| None=None) -> None` | Delete a document by id/rev (fetch rev when omitted). |
| `CouchDBClient.find` (`L108`) | `def CouchDBClient.find(self, selector: dict[str, Any], limit: int=200) -> list[dict[str, Any]]` | Execute a Mango ``_find`` query and return matched docs. |
| `CouchDBClient.list_depositions` (`L118`) | `def CouchDBClient.list_depositions(self, case_id: str) -> list[dict[str, Any]]` | List deposition documents for a case. |

## `backend/app/graph.py`

**Artifact purpose:** No module docstring present; see function-level details below.

| Function | Signature | Description |
| --- | --- | --- |
| `DepositionWorkflow.__init__` (`L42`) | `def DepositionWorkflow.__init__(self, settings: Settings, couchdb: CouchDBClient) -> None` | Initialize workflow dependencies and compile the graph. |
| `DepositionWorkflow._build_graph` (`L54`) | `def DepositionWorkflow._build_graph(self)` | Build and compile the LangGraph node/edge topology. |
| `DepositionWorkflow.run` (`L74`) | `def DepositionWorkflow.run(self, case_id: str, file_path: str, llm_provider: str \| None=None, llm_model: str \| None=None) -> dict` | Run the workflow for a single deposition file. |
| `DepositionWorkflow.reassess_case` (`L92`) | `def DepositionWorkflow.reassess_case(self, case_id: str, llm_provider: str \| None=None, llm_model: str \| None=None) -> list[dict]` | Recompute contradiction assessments for every deposition in a case. |
| `DepositionWorkflow._read_file` (`L117`) | `def DepositionWorkflow._read_file(self, state: GraphState) -> GraphState` | Read and decode deposition text with tolerant encoding fallbacks. |
| `DepositionWorkflow._map_deposition` (`L136`) | `def DepositionWorkflow._map_deposition(self, state: GraphState) -> GraphState` | Map raw deposition text into a structured ``DepositionSchema``. |
| `DepositionWorkflow._fallback_map_deposition` (`L231`) | `def DepositionWorkflow._fallback_map_deposition(self, state: GraphState, file_name: str) -> DepositionSchema` | Heuristic non-LLM mapping helper retained for testability/backstop. |
| `DepositionWorkflow._extract_first_group` (`L281`) | `def DepositionWorkflow._extract_first_group(self, text: str, pattern: str) -> str \| None` | Extract first regex capture group or ``None`` when absent. |
| `DepositionWorkflow._split_sentences` (`L290`) | `def DepositionWorkflow._split_sentences(self, text: str) -> list[str]` | Split free-form text into rough sentence units. |
| `DepositionWorkflow._infer_topic` (`L296`) | `def DepositionWorkflow._infer_topic(self, sentence: str) -> str` | Infer a short topic label from a claim sentence. |
| `DepositionWorkflow._save_deposition` (`L317`) | `def DepositionWorkflow._save_deposition(self, state: GraphState) -> GraphState` | Persist mapped deposition content into CouchDB. |
| `DepositionWorkflow._load_other_depositions` (`L343`) | `def DepositionWorkflow._load_other_depositions(self, state: GraphState) -> GraphState` | Load peer depositions in the same case (bounded context window). |
| `DepositionWorkflow._evaluate_contradictions` (`L351`) | `def DepositionWorkflow._evaluate_contradictions(self, state: GraphState) -> GraphState` | Evaluate target deposition against peers and attach assessment. |
| `DepositionWorkflow._assess_deposition_against_peers` (`L364`) | `def DepositionWorkflow._assess_deposition_against_peers(self, target_doc: dict, other_depositions: list[dict], llm_provider: str \| None=None, llm_model: str \| None=None, trace_events: list[dict] \| None=None) -> ContradictionAssessment` | Run contradiction assessment using structured-output LLM calls. |
| `DepositionWorkflow._is_structured_parse_failure` (`L504`) | `def DepositionWorkflow._is_structured_parse_failure(self, exc: Exception) -> bool` | Return ``True`` when an exception indicates structured-output parsing failure. |
| `DepositionWorkflow._append_assessment_trace` (`L520`) | `def DepositionWorkflow._append_assessment_trace(self, trace_events: list[dict] \| None, *, target_doc: dict, llm_provider: str \| None, llm_model: str \| None, system_prompt: str, user_prompt: str, assessment: ContradictionAssessment, elapsed_ms: int, result_source: str) -> None` | Append one attorney assessment trace event. |
| `DepositionWorkflow._trace_model_name` (`L566`) | `def DepositionWorkflow._trace_model_name(self, requested_model: str \| None) -> str` | Resolve effective model name for trace metadata. |
| `DepositionWorkflow._normalize_provider` (`L571`) | `def DepositionWorkflow._normalize_provider(self, provider: str \| None)` | Normalize provider string for trace payload typing. |
| `DepositionWorkflow._preview_text` (`L577`) | `def DepositionWorkflow._preview_text(self, value: str, limit: int) -> str` | Trim large text blocks for UI trace display. |
| `DepositionWorkflow._get_llm` (`L585`) | `def DepositionWorkflow._get_llm(self, llm_provider: str \| None, llm_model: str \| None, *, temperature: float)` | Return default workflow model or provider/model override. |
| `DepositionWorkflow._fallback_assess_deposition` (`L597`) | `def DepositionWorkflow._fallback_assess_deposition(self, target_doc: dict, other_depositions: list[dict]) -> ContradictionAssessment` | Heuristic contradiction assessor used in utility/test scenarios. |
| `DepositionWorkflow._topics_overlap` (`L669`) | `def DepositionWorkflow._topics_overlap(self, left_topic: str, right_topic: str, left_statement: str, right_statement: str) -> bool` | Determine whether two claims likely refer to the same subject. |
| `DepositionWorkflow._keyword_tokens` (`L684`) | `def DepositionWorkflow._keyword_tokens(self, value: str) -> set[str]` | Extract informative keyword tokens, excluding common stopwords. |
| `DepositionWorkflow._claims_conflict` (`L707`) | `def DepositionWorkflow._claims_conflict(self, left_statement: str, right_statement: str) -> tuple[bool, str, int]` | Detect conflict patterns between two claim statements. |
| `DepositionWorkflow._contains_negation` (`L747`) | `def DepositionWorkflow._contains_negation(self, value: str) -> bool` | Check whether statement text contains negation semantics. |
| `DepositionWorkflow._extract_time_minutes` (`L768`) | `def DepositionWorkflow._extract_time_minutes(self, value: str) -> int \| None` | Parse a clock timestamp from text and convert to minutes since midnight. |
| `DepositionWorkflow._persist_assessment` (`L786`) | `def DepositionWorkflow._persist_assessment(self, state: GraphState) -> GraphState` | Persist contradiction assessment fields to the deposition document. |

## `backend/app/llm.py`

**Artifact purpose:** No module docstring present; see function-level details below.

| Function | Signature | Description |
| --- | --- | --- |
| `LLMOperationalError.__init__` (`L33`) | `def LLMOperationalError.__init__(self, message: str, possible_fix: str) -> None` | Attach an actionable fix alongside the failure message. |
| `parse_model_list` (`L46`) | `def parse_model_list(raw: str) -> list[str]` | Parse comma-separated model names into a trimmed list. |
| `_dedupe_preserve_order` (`L53`) | `def _dedupe_preserve_order(items: Iterable[str]) -> list[str]` | Return unique items while preserving the first-seen order. |
| `resolve_llm_selection` (`L66`) | `def resolve_llm_selection(settings: Settings, llm_provider: str \| None, llm_model: str \| None) -> tuple[str, str]` | Resolve final provider/model using request values and settings defaults. |
| `build_chat_model` (`L96`) | `def build_chat_model(settings: Settings, llm_provider: str \| None, llm_model: str \| None, *, temperature: float)` | Create a LangChain chat model instance for the selected provider/model. |
| `_possible_fix_from_exception` (`L124`) | `def _possible_fix_from_exception(settings: Settings, provider: str, model: str, exc: Exception) -> str` | Map low-level provider errors to concrete user remediation guidance. |
| `_normalize_ollama_model_names` (`L177`) | `def _normalize_ollama_model_names(values: Iterable[str]) -> set[str]` | Normalize Ollama model aliases (with/without ``:latest``). |
| `fetch_ollama_models` (`L193`) | `def fetch_ollama_models(settings: Settings) -> list[str]` | Fetch installed Ollama model tags from ``/api/tags``. |
| `_assert_ollama_model_loaded` (`L212`) | `def _assert_ollama_model_loaded(settings: Settings, model: str) -> None` | Ensure Ollama is reachable and the requested model exists locally. |
| `_probe_structured_output` (`L236`) | `def _probe_structured_output(settings: Settings, provider: str, model: str) -> None` | Run a lightweight structured-output probe against the selected model. |
| `clear_llm_readiness_cache` (`L266`) | `def clear_llm_readiness_cache() -> None` | Clear in-process readiness cache used to reduce repetitive probes. |
| `_readiness_cache_key` (`L272`) | `def _readiness_cache_key(provider: str, model: str) -> tuple[str, str]` | Build normalized cache key for a provider/model pair. |
| `ensure_llm_operational` (`L278`) | `def ensure_llm_operational(settings: Settings, provider: str, model: str, *, force_probe: bool=False) -> None` | Validate provider prerequisites and perform readiness probe. |
| `_quick_llm_option_check` (`L320`) | `def _quick_llm_option_check(settings: Settings, provider: str, model: str) -> None` | Run fast pre-checks used for non-refresh model dropdown loads. |
| `get_llm_option_status` (`L334`) | `def get_llm_option_status(settings: Settings, provider: str, model: str, *, force_probe: bool=False) -> dict[str, str \| bool \| None]` | Return operational status payload used by ``/api/llm-options``. |
| `llm_failure_message` (`L357`) | `def llm_failure_message(settings: Settings, llm_provider: str \| None, llm_model: str \| None, exc: Exception) -> str` | Compose standardized runtime failure text with suggested fix. |
| `list_llm_options` (`L370`) | `def list_llm_options(settings: Settings) -> list[dict[str, str]]` | List selectable OpenAI/Ollama model options for frontend dropdowns. |

## `backend/app/main.py`

**Artifact purpose:** No module docstring present; see function-level details below.

| Function | Signature | Description |
| --- | --- | --- |
| `lifespan` (`L109`) | `async def lifespan(_: FastAPI)` | Application lifecycle hook. Startup: - validates default LLM connectivity (fail-fast) - ensures CouchDB database exists Shutdown: - closes CouchDB HTTP client |
| `_container_suffix_aliases` (`L141`) | `def _container_suffix_aliases(suffix: Path) -> list[Path]` | Return known compatibility aliases for sample deposition subpaths. |
| `_container_suffix_variants` (`L157`) | `def _container_suffix_variants(suffix: Path) -> list[Path]` | Return normalized suffix variants for container-root path mapping. |
| `_deposition_root_doc_id` (`L167`) | `def _deposition_root_doc_id(path: str) -> str` | Build stable cache-document id for one deposition root path. |
| `_env_extra_deposition_roots` (`L174`) | `def _env_extra_deposition_roots() -> list[Path]` | Resolve additional deposition roots from ``DEPOSITION_EXTRA_DIRS``. |
| `_cached_extra_deposition_roots` (`L189`) | `def _cached_extra_deposition_roots() -> list[Path]` | Load cached deposition roots persisted by the runtime add-path endpoint. |
| `_configured_extra_deposition_roots` (`L207`) | `def _configured_extra_deposition_roots() -> list[Path]` | Return de-duplicated extra roots from env config plus cached runtime paths. |
| `_build_ingest_candidates` (`L221`) | `def _build_ingest_candidates(requested_path: str) -> list[Path]` | Build candidate paths for ingestion, including container/host mappings. |
| `_txt_count` (`L272`) | `def _txt_count(path: Path) -> int` | Count immediate ``.txt`` files in a directory. |
| `_add_directory_option` (`L286`) | `def _add_directory_option(options: list[DepositionDirectoryOption], seen: set[str], base_path: Path, path: Path, source: Literal['mounted', 'configured', 'repo']) -> None` | Add one UI directory option when the directory contains text files. |
| `_configured_deposition_root` (`L323`) | `def _configured_deposition_root() -> Path` | Resolve configured deposition directory to an absolute host path. |
| `_ingestable_directory_count` (`L332`) | `def _ingestable_directory_count(root: Path) -> int` | Return count of ingestable directories (root + immediate children). |
| `_resolve_directory_base` (`L344`) | `def _resolve_directory_base() -> tuple[Literal['mounted', 'configured', 'repo'], Path]` | Resolve the single shared base directory for ingestion folder choices. |
| `_list_deposition_directories` (`L365`) | `def _list_deposition_directories() -> tuple[Path, list[DepositionDirectoryOption]]` | Discover valid ingestion directories from configured root paths. |
| `_suggest_directory_option` (`L386`) | `def _suggest_directory_option(options: list[DepositionDirectoryOption]) -> str \| None` | Choose a preferred default path for the UI directory navigator. |
| `_path_has_glob` (`L405`) | `def _path_has_glob(path: Path) -> bool` | Return ``True`` when a path string contains basic glob tokens. |
| `_collect_txt_files` (`L412`) | `def _collect_txt_files(candidate: Path) -> list[Path]` | Collect ``.txt`` files from a file, directory, or glob candidate path. |
| `_collect_owl_files` (`L435`) | `def _collect_owl_files(candidate: Path) -> list[Path]` | Collect ``.owl`` files from a file, directory, or glob candidate path. |
| `_resolve_ingest_txt_files` (`L458`) | `def _resolve_ingest_txt_files(requested_path: str) -> list[Path]` | Resolve requested input into unique, sorted deposition text files. |
| `_resolve_ontology_owl_files` (`L486`) | `def _resolve_ontology_owl_files(requested_path: str) -> list[Path]` | Resolve one requested ontology path into unique, sorted ``.owl`` files. |
| `_configured_ontology_root` (`L530`) | `def _configured_ontology_root() -> Path` | Resolve configured ontology directory to an absolute host path. |
| `_list_ontology_owl_options` (`L539`) | `def _list_ontology_owl_options() -> tuple[Path, list[GraphOntologyOption], str]` | Discover OWL path options for the ontology dropdown. |
| `_resolve_ontology_browser_directory` (`L559`) | `def _resolve_ontology_browser_directory(requested_path: str \| None) -> tuple[Path, Path]` | Resolve and validate ontology browser directory under configured base root. |
| `_list_ontology_browser_entries` (`L604`) | `def _list_ontology_browser_entries(directory: Path) -> tuple[list[GraphOntologyBrowserEntry], list[GraphOntologyBrowserEntry]]` | List immediate subdirectories and OWL files for one ontology browse directory. |
| `_normalize_deposition_root_path` (`L628`) | `def _normalize_deposition_root_path(path_text: str) -> Path` | Normalize a user-supplied deposition root path into an absolute path. |
| `_cache_deposition_root` (`L637`) | `def _cache_deposition_root(path: str) -> None` | Persist one user-added deposition root so it appears in future dropdown loads. |
| `_trace_doc_id` (`L663`) | `def _trace_doc_id(trace_id: str) -> str` | Build stable document id for one trace session. |
| `_public_trace_session` (`L670`) | `def _public_trace_session(session: dict) -> dict` | Project internal trace session structure into API payload shape. |
| `_max_trace_sequence` (`L687`) | `def _max_trace_sequence(trace_payload: dict) -> int` | Return current max event sequence in a trace payload. |
| `_load_trace_session` (`L700`) | `def _load_trace_session(trace_id: str) -> dict \| None` | Load persisted trace session from thought-stream database. |
| `_ensure_trace_session` (`L731`) | `def _ensure_trace_session(trace_id: str) -> dict` | Create or fetch one trace session with internal bookkeeping metadata. |
| `_flush_trace_session` (`L764`) | `def _flush_trace_session(trace_id: str, *, force: bool=False) -> None` | Persist trace session to thought-stream DB with batched/coalesced writes. |
| `_trace_session_snapshot` (`L804`) | `def _trace_session_snapshot(trace_id: str) -> dict \| None` | Return one trace snapshot from memory or persisted thought-stream DB. |
| `_append_trace_events` (`L820`) | `def _append_trace_events(trace_id: str \| None, *, legal_clerk: list[dict] \| None=None, attorney: list[dict] \| None=None, status: Literal['running', 'completed', 'failed'] \| None=None) -> None` | Append events to one trace session and optionally update status. |
| `_delete_trace_session` (`L861`) | `def _delete_trace_session(trace_id: str) -> bool` | Delete one trace session from in-memory cache. |
| `_normalize_trace_status` (`L883`) | `def _normalize_trace_status(value: str \| None) -> Literal['running', 'completed', 'failed']` | Normalize trace-session status values to known enum members. |
| `_parse_iso_datetime` (`L892`) | `def _parse_iso_datetime(value: str \| None) -> datetime \| None` | Parse an ISO timestamp string and normalize into UTC. |
| `_flatten_trace_events` (`L908`) | `def _flatten_trace_events(trace_payload: dict \| None) -> list[dict]` | Merge legal-clerk and attorney events into one ordered event list. |
| `_percentile` (`L929`) | `def _percentile(values: list[float], pct: float) -> float \| None` | Return percentile value using linear interpolation over sorted values. |
| `_status_high_is_bad` (`L944`) | `def _status_high_is_bad(value: float, *, warn_at: float, bad_at: float) -> Literal['good', 'warn', 'bad']` | Assign health status where larger values indicate worse performance. |
| `_status_low_is_bad` (`L954`) | `def _status_low_is_bad(value: float, *, warn_below: float, bad_below: float) -> Literal['good', 'warn', 'bad']` | Assign health status where smaller values indicate worse performance. |
| `_status_band` (`L964`) | `def _status_band(value: float, *, warn_low: float, warn_high: float, bad_low: float, bad_high: float) -> Literal['good', 'warn', 'bad']` | Assign health status for values expected to stay within a healthy band. |
| `_normalize_metrics_session` (`L981`) | `def _normalize_metrics_session(raw: dict) -> dict \| None` | Normalize raw trace session data into one metrics-friendly shape. |
| `_collect_runtime_trace_sessions` (`L999`) | `def _collect_runtime_trace_sessions() -> tuple[list[dict], bool]` | Collect deduplicated trace sessions from DB and in-memory runtime cache. |
| `_compute_agent_runtime_metrics` (`L1031`) | `def _compute_agent_runtime_metrics(sessions: list[dict], *, lookback_hours: int, storage_connected: bool) -> AgentRuntimeMetricsResponse` | Compute dashboard KPIs for running-agent and LLM runtime health. |
| `_safe_case_depositions` (`L1211`) | `def _safe_case_depositions(case_id: str) -> list[dict]` | Fetch case depositions defensively for purge/sync operations. |
| `_purge_stale_case_depositions` (`L1226`) | `def _purge_stale_case_depositions(case_id: str, selected_files: list[Path]) -> None` | Remove existing case docs not present in the selected ingestion folder. |
| `_canonical_deposition_doc_id` (`L1248`) | `def _canonical_deposition_doc_id(case_id: str, file_name: str) -> str` | Build the canonical deposition doc id used by workflow persistence. |
| `_purge_noncanonical_case_depositions` (`L1257`) | `def _purge_noncanonical_case_depositions(case_id: str, selected_files: list[Path]) -> None` | Remove selected-file deposition docs whose ids are not canonical. This prevents duplicate rows when older docs used legacy/random ids but current ingest writes deterministic ids from ``case_id + file_name``. |
| `_dashboard_score` (`L1291`) | `def _dashboard_score(item: dict) -> float` | Normalize contradiction score for stable dashboard sorting. |
| `_utc_now_iso` (`L1298`) | `def _utc_now_iso() -> str` | Return current UTC time in ISO 8601 format. |
| `_case_doc_id` (`L1304`) | `def _case_doc_id(case_id: str) -> str` | Build stable case-document id from a case id string. |
| `_load_case_doc` (`L1311`) | `def _load_case_doc(case_id: str) -> dict \| None` | Fetch case index document when present. |
| `_save_case_memory` (`L1334`) | `def _save_case_memory(case_id: str, channel: str, payload: dict) -> None` | Persist one case memory/event record in CouchDB. |
| `_upsert_case_doc` (`L1354`) | `def _upsert_case_doc(case_id: str, *, deposition_count: int \| None=None, memory_increment: int=0, last_action: str \| None=None, last_directory: str \| None=None, llm_provider: str \| None=None, llm_model: str \| None=None) -> None` | Create/update case index metadata document. |
| `_list_case_summaries` (`L1399`) | `def _list_case_summaries() -> list[CaseSummary]` | Build case index list from case docs with deposition fallback. |
| `_delete_case_docs` (`L1445`) | `def _delete_case_docs(case_id: str) -> int` | Delete all case-related docs and return deleted count. |
| `_delete_case_deposition_docs` (`L1460`) | `def _delete_case_deposition_docs(case_id: str) -> int` | Delete only deposition docs for a case id and return deleted count. |
| `_rename_case_docs` (`L1475`) | `def _rename_case_docs(old_case_id: str, new_case_id: str) -> int` | Rename ``case_id`` for all matching docs and return updated count. |
| `_case_has_docs` (`L1494`) | `def _case_has_docs(case_id: str) -> bool` | Return True when any docs exist for a case id. |
| `_clone_case_contents` (`L1503`) | `def _clone_case_contents(source_case_id: str, target_case_id: str) -> int` | Clone case-scoped content docs from source to target case id. |
| `_list_case_versions` (`L1517`) | `def _list_case_versions(case_id: str) -> list[CaseVersionSummary]` | List saved case versions sorted by newest-first. |
| `_save_case_version` (`L1541`) | `def _save_case_version(request: SaveCaseVersionRequest) -> CaseVersionSummary` | Persist a case snapshot as the next version and return it. |
| `_resolve_request_llm` (`L1609`) | `def _resolve_request_llm(llm_provider: str \| None, llm_model: str \| None) -> tuple[str, str]` | Resolve and validate requested LLM provider/model for an API call. |
| `_ensure_request_llm_operational` (`L1618`) | `def _ensure_request_llm_operational(llm_provider: str, llm_model: str) -> None` | Enforce runtime readiness for the selected provider/model. |
| `_ensure_startup_llm_connectivity` (`L1630`) | `def _ensure_startup_llm_connectivity() -> None` | Fail startup when default configured LLM is not operational. |
| `root` (`L1644`) | `def root() -> FileResponse` | Serve the frontend entry HTML. |
| `get_llm_options` (`L1651`) | `def get_llm_options(force_probe: bool=False) -> LLMOptionsResponse` | Return model dropdown options with per-model readiness metadata. |
| `get_deposition_directories` (`L1683`) | `def get_deposition_directories() -> DepositionDirectoriesResponse` | Return valid ingestion directories for the UI folder navigator. |
| `add_deposition_root` (`L1695`) | `def add_deposition_root(request: DepositionRootRequest) -> DepositionRootResponse` | Validate and cache one additional deposition root path. The path must be accessible from the API runtime filesystem. When the API runs inside Docker, this means the host path must be bind-mounted into the container first. |
| `graph_browser_info` (`L1753`) | `def graph_browser_info() -> GraphBrowserResponse` | Return Neo4j Browser URL and Bolt endpoint details for graph exploration. |
| `graph_rag_health` (`L1764`) | `def graph_rag_health() -> GraphHealthResponse` | Return Neo4j configuration/connectivity status for Graph RAG readiness checks. |
| `graph_rag_owl_options` (`L1771`) | `def graph_rag_owl_options() -> GraphOntologyOptionsResponse` | Return selectable OWL file path options for Graph RAG ontology loading. |
| `graph_rag_owl_browser` (`L1783`) | `def graph_rag_owl_browser(path: str \| None=None) -> GraphOntologyBrowserResponse` | Return one level of ontology directory/file rows for file-browser style UI. |
| `load_graph_rag_ontology` (`L1800`) | `def load_graph_rag_ontology(request: GraphOntologyLoadRequest) -> GraphOntologyLoadResponse` | Load one or more OWL ontology files into Neo4j for Graph RAG indexing. |
| `query_graph_rag` (`L1826`) | `def query_graph_rag(request: GraphRagQueryRequest) -> GraphRagQueryResponse` | Answer one question using Neo4j ontology retrieval as the RAG context source. |
| `thought_stream_health` (`L1889`) | `def thought_stream_health() -> dict[str, str \| bool]` | Validate thought-stream CouchDB connectivity for UI toggle plumbing checks. |
| `get_agent_metrics` (`L1910`) | `def get_agent_metrics(lookback_hours: int=24) -> AgentRuntimeMetricsResponse` | Return runtime KPI metrics for monitoring running agent/LLM behavior. |
| `get_trace_session` (`L1924`) | `def get_trace_session(thought_stream_id: str) -> TraceSessionResponse` | Return current thought-stream events for one active/past stream id. |
| `save_trace_session` (`L1934`) | `def save_trace_session(thought_stream_id: str, request: SaveTraceRequest) -> SaveTraceResponse` | Persist thought-stream payload into case memory for later audit/review. |
| `delete_trace_session` (`L1975`) | `def delete_trace_session(thought_stream_id: str) -> DeleteTraceResponse` | Discard one in-memory thought-stream session. |
| `list_cases` (`L1985`) | `def list_cases() -> CaseListResponse` | List all known cases for the vertical case index. |
| `list_case_versions` (`L1995`) | `def list_case_versions(case_id: str) -> CaseVersionListResponse` | List saved case versions for scrolling and rerun. |
| `save_case` (`L2009`) | `def save_case(request: SaveCaseRequest) -> CaseSummary` | Create/update a case index item so it appears in the Case Index list. |
| `save_case_version` (`L2036`) | `def save_case_version(request: SaveCaseVersionRequest) -> CaseVersionSummary` | Save a version snapshot for the selected case. |
| `rename_case` (`L2043`) | `def rename_case(case_id: str, request: RenameCaseRequest) -> RenameCaseResponse` | Rename case id across all persisted case/deposition/memory docs. |
| `delete_case` (`L2084`) | `def delete_case(case_id: str) -> DeleteCaseResponse` | Delete all docs belonging to a case id. |
| `clear_case_depositions` (`L2095`) | `def clear_case_depositions(case_id: str) -> ClearCaseDepositionsResponse` | Remove all deposition docs for one case while preserving case metadata. |
| `ingest_case` (`L2124`) | `def ingest_case(request: IngestCaseRequest) -> IngestCaseResponse` | Ingest all deposition text files for a case and return updated scores. |
| `list_depositions` (`L2281`) | `def list_depositions(case_id: str) -> list[dict]` | List case depositions sorted by descending contradiction score. |
| `get_deposition` (`L2290`) | `def get_deposition(deposition_id: str) -> dict` | Return full deposition document by id. |
| `chat` (`L2300`) | `def chat(request: ChatRequest) -> ChatResponse` | Generate attorney chat response for a selected deposition context. |
| `reason_contradiction` (`L2401`) | `def reason_contradiction(request: ContradictionReasonRequest) -> ContradictionReasonResponse` | Re-analyze a single contradiction item with strict model validation. |

## `backend/app/models.py`

**Artifact purpose:** No module docstring present; see function-level details below.

| Function | Signature | Description |
| --- | --- | --- |
| `Claim.normalize_confidence_scale` (`L27`) | `def Claim.normalize_confidence_scale(cls, value)` | Accept percent-style confidence values and normalize to 0..1. Some local models emit confidence as whole-number percentages (for example ``80`` or ``"80%"``). Normalize those values to decimal form while keeping strict validation for other out-of-range decimal values (for example ``1.2`` remains invalid). |

## `backend/app/neo4j_graph.py`

**Artifact purpose:** No module docstring present; see function-level details below.

| Function | Signature | Description |
| --- | --- | --- |
| `split_iri` (`L126`) | `def split_iri(value: str) -> tuple[str, str]` | Split an IRI into namespace and local-name fragments. |
| `node_to_iri` (`L140`) | `def node_to_iri(node: URIRef \| BNode) -> str` | Normalize RDF URI/BNode into one stable graph identifier. |
| `resource_row` (`L148`) | `def resource_row(iri: str) -> dict[str, str]` | Build one :Resource upsert row from an IRI string. |
| `literal_key` (`L160`) | `def literal_key(value: str, datatype: str, lang: str) -> str` | Create one deterministic key for literal node de-duplication. |
| `Neo4jOntologyGraph.__init__` (`L170`) | `def Neo4jOntologyGraph.__init__(self, *, uri: str, user: str, password: str, database: str, browser_url: str) -> None` | Initialize one graph adapter with connection settings. |
| `Neo4jOntologyGraph.configured` (`L189`) | `def Neo4jOntologyGraph.configured(self) -> bool` | Return whether essential Neo4j connection settings are present. |
| `Neo4jOntologyGraph._get_driver` (`L194`) | `def Neo4jOntologyGraph._get_driver(self)` | Return a lazily-created Neo4j driver instance. |
| `Neo4jOntologyGraph.close` (`L205`) | `def Neo4jOntologyGraph.close(self) -> None` | Close active Neo4j driver connection when present. |
| `Neo4jOntologyGraph.health` (`L212`) | `def Neo4jOntologyGraph.health(self) -> dict[str, Any]` | Check basic Neo4j connectivity and return status payload. |
| `Neo4jOntologyGraph.ensure_constraints` (`L247`) | `def Neo4jOntologyGraph.ensure_constraints(self) -> None` | Ensure uniqueness constraints used by ontology graph upserts. |
| `Neo4jOntologyGraph.clear_graph` (`L255`) | `def Neo4jOntologyGraph.clear_graph(self) -> None` | Delete all graph nodes/relationships from the selected database. |
| `Neo4jOntologyGraph._parse_graph_file` (`L262`) | `def Neo4jOntologyGraph._parse_graph_file(self, file_path: Path) -> Graph` | Parse one ontology file as RDF graph with OWL-friendly fallbacks. |
| `Neo4jOntologyGraph._flush_batch` (`L273`) | `def Neo4jOntologyGraph._flush_batch(self, session, *, resource_rows: dict[str, dict[str, str]], resource_rels: list[dict[str, str]], literal_rels: list[dict[str, str]]) -> None` | Flush one prepared batch into Neo4j and clear mutable buffers. |
| `Neo4jOntologyGraph.load_owl_files` (`L295`) | `def Neo4jOntologyGraph.load_owl_files(self, file_paths: Iterable[Path], *, clear_existing: bool, batch_size: int) -> dict[str, Any]` | Load OWL file triples into Neo4j with batched MERGE upserts. |
| `Neo4jOntologyGraph._search_terms` (`L400`) | `def Neo4jOntologyGraph._search_terms(self, question: str) -> list[str]` | Extract stable lowercase retrieval terms from a Graph RAG question. |
| `Neo4jOntologyGraph.retrieve_context` (`L447`) | `def Neo4jOntologyGraph.retrieve_context(self, question: str, *, node_limit: int=8) -> dict[str, Any]` | Retrieve ontology context rows relevant to one natural-language question. |

## `backend/app/prompts.py`

**Artifact purpose:** No module docstring present; see function-level details below.

| Function | Signature | Description |
| --- | --- | --- |
| `_prompt_dir` (`L26`) | `def _prompt_dir() -> Path` | Return the on-disk prompt template directory. |
| `load_prompt` (`L33`) | `def load_prompt(name: str) -> str` | Load a named prompt template from disk (cached per process). |
| `render_prompt` (`L47`) | `def render_prompt(name: str, **kwargs) -> str` | Render a prompt template using ``str.format`` variables. |

## `backend/app/schemas.py`

**Artifact purpose:** No module docstring present; see function-level details below.

| Function | Signature | Description |
| --- | --- | --- |
| `_schema_dir` (`L14`) | `def _schema_dir() -> Path` | Return on-disk directory containing JSON schema files. |
| `load_schema` (`L21`) | `def load_schema(name: str) -> dict` | Load a named schema JSON file from disk. |

## `frontend/app.js`

**Artifact purpose:** Frontend controller for the deposition dashboard. Responsibilities: - fetch API data - maintain UI state (selected deposition, chat history, processing indicators) - render timeline/list/detail/chat panels - enforce LLM model readiness before invoking expensive operations

| Function | Signature | Description |
| --- | --- | --- |
| `escapeHtml` (`L187`) | `function escapeHtml(value)` | Escape dynamic text before inserting into innerHTML snippets. |
| `api` (`L197`) | `async function api(path, options = {})` | Perform JSON API calls and normalize non-2xx errors. |
| `setStatus` (`L226`) | `function setStatus(message)` | Render a short status message in the control panel. |
| `clearMetricSelection` (`L231`) | `function clearMetricSelection()` | Clear selected state from all metric cards in runtime + correctness grids. |
| `showMetricDetail` (`L236`) | `function showMetricDetail(metric, source)` | Render expanded selected-metric details in the metrics detail panel. |
| `describeMetricValueImpact` (`L268`) | `function describeMetricValueImpact(metric, source)` | Explain how a metric's current value relates to present system health/behavior. |
| `resetMetricDetail` (`L294`) | `function resetMetricDetail()` | Hide expanded metric-detail panel and clear previous selection copy. |
| `renderMetricCards` (`L304`) | `function renderMetricCards(container, metrics, source)` | Render generic metric cards into a target grid container. |
| `renderCorrectnessDriftObservables` (`L350`) | `function renderCorrectnessDriftObservables()` | Render static correctness/drift KPI definitions with formulas and thresholds. |
| `renderAgentMetrics` (`L359`) | `function renderAgentMetrics(payload)` | Render runtime KPI cards and metadata into the Agent Runtime Metrics panel. |
| `loadAgentMetrics` (`L377`) | `async function loadAgentMetrics({ silent = false } = {})` | Fetch runtime KPI payload from backend and refresh dashboard cards. |
| `stopMetricsPolling` (`L387`) | `function stopMetricsPolling()` | Stop periodic runtime metrics polling loop. |
| `startMetricsPolling` (`L395`) | `function startMetricsPolling()` | Start periodic runtime metrics polling loop. |
| `setMetricsPanelOpen` (`L403`) | `function setMetricsPanelOpen(open)` | Toggle runtime metrics body visibility from text-trigger click state. |
| `toggleMetricsPanel` (`L417`) | `async function toggleMetricsPanel()` | Expand/collapse metrics body; load dashboard metrics on first expansion. |
| `createTraceId` (`L431`) | `function createTraceId()` | Create client-side thought-stream id for backend stream correlation. |
| `syncTraceActionState` (`L439`) | `function syncTraceActionState()` | Keep thought-stream navigation controls aligned with toggle state. |
| `setTraceStreamEnabled` (`L445`) | `function setTraceStreamEnabled(enabled)` | Toggle trace stream panel and reset stream state when disabled. |
| `verifyThoughtStreamStorage` (`L469`) | `async function verifyThoughtStreamStorage()` | Ensure Thought Stream CouchDB plumbing is reachable before live streaming UI is enabled. |
| `handleTraceStreamToggle` (`L479`) | `async function handleTraceStreamToggle()` | Validate Thought Stream storage connectivity before turning live viewer on. |
| `formatTraceEvents` (`L498`) | `function formatTraceEvents(events = [])` | Convert thought-stream events into readable plain text. |
| `flattenTraceEvents` (`L532`) | `function flattenTraceEvents(snapshot)` | Combine legal-clerk and attorney traces into one ordered stream. |
| `applyTraceWindow` (`L554`) | `function applyTraceWindow(events, status)` | Render sliding window over flattened trace events. |
| `shiftTraceWindow` (`L573`) | `function shiftTraceWindow(direction)` | Move thought-stream sliding window older/newer and re-render current snapshot. |
| `renderTraceSnapshot` (`L592`) | `function renderTraceSnapshot(snapshot)` | Render one thought-stream snapshot into sliding window viewer. |
| `pollTraceOnce` (`L604`) | `async function pollTraceOnce()` | Fetch and render latest thought-stream session state. |
| `stopTracePolling` (`L621`) | `function stopTracePolling()` | Stop live trace polling loop. |
| `startTracePolling` (`L629`) | `function startTracePolling()` | Start periodic polling for active thought-stream session updates. |
| `beginTraceSession` (`L641`) | `function beginTraceSession(channel)` | Initialize live thought-stream UI and state for one operation. |
| `finalizeTraceSession` (`L658`) | `async function finalizeTraceSession()` | Stop polling and fetch one last thought-stream snapshot. |
| `syncCaseActionState` (`L667`) | `function syncCaseActionState()` | Keep case-index actions aligned with current case id/name values. |
| `formatSeconds` (`L676`) | `function formatSeconds(startMs)` | Format elapsed time from a start timestamp (performance.now). |
| `startClock` (`L682`) | `function startClock(key, el)` | Start a requestAnimationFrame-driven elapsed-time clock. |
| `stopClock` (`L693`) | `function stopClock(key)` | Stop a running clock by timer key. |
| `nextPaint` (`L701`) | `async function nextPaint()` | Wait one paint frame so status/progress UI is visible before async work. |
| `setControlsDisabled` (`L706`) | `function setControlsDisabled(disabled)` | Toggle top-level controls while UI operations are in-flight. |
| `beginInferencingRequest` (`L730`) | `function beginInferencingRequest()` | Register one cancellable inferencing request and return its abort controller. |
| `endInferencingRequest` (`L738`) | `function endInferencingRequest(controller)` | Unregister one inferencing request controller. |
| `inferencingApi` (`L744`) | `async function inferencingApi(path, options = {})` | Execute API call with cancellation support for inferencing operations. |
| `stopInferencing` (`L754`) | `function stopInferencing()` | Abort all active inferencing requests (ingest + analysis). |
| `startUiProcessing` (`L771`) | `function startUiProcessing(message)` | Enter UI-processing mode with optional status update. |
| `endUiProcessing` (`L780`) | `function endUiProcessing()` | Exit UI-processing mode and re-enable controls when queue is empty. |
| `startLlmProcessing` (`L788`) | `function startLlmProcessing(message)` | Enter LLM-processing mode and start global processing indicator clock. |
| `endLlmProcessing` (`L801`) | `function endLlmProcessing()` | Exit LLM-processing mode and hide global indicator when idle. |
| `setReasoningProcessing` (`L811`) | `function setReasoningProcessing(active, message = '')` | Toggle focused contradiction reasoning spinner/clock state. |
| `setChatProcessing` (`L824`) | `function setChatProcessing(active)` | Toggle chat in-flight state and disable chat input/send during generation. |
| `clearCurrentCaseView` (`L836`) | `function clearCurrentCaseView()` | Clear loaded deposition/chat/detail state for starting a new blank case. |
| `depositionSortByScore` (`L850`) | `function depositionSortByScore(a, b)` | Sort helper for contradiction risk score (descending). |
| `timelineSort` (`L855`) | `function timelineSort(a, b)` | Sort helper for timeline ordering by deposition date, then filename. |
| `timelineVisibleSlots` (`L871`) | `function timelineVisibleSlots(itemCount)` | Return timeline cards visible at once (desktop=5, mobile=2). |
| `updateTimelineSlots` (`L877`) | `function updateTimelineSlots()` | Apply visible-slot count CSS variable for the current timeline item count. |
| `timelineStepPixels` (`L886`) | `function timelineStepPixels()` | Return one page-step width for timeline nav buttons. |
| `syncTimelineNavButtons` (`L899`) | `function syncTimelineNavButtons()` | Disable timeline nav buttons at edges and when no overflow exists. |
| `scrollTimeline` (`L911`) | `function scrollTimeline(direction)` | Scroll timeline by one visible page in requested direction (-1 or +1). |
| `parseDepositionDate` (`L923`) | `function parseDepositionDate(value)` | Parse deposition date into epoch milliseconds; return null when invalid. |
| `displayDate` (`L932`) | `function displayDate(value)` | Human-friendly date label for timeline cards. |
| `encodeLlmOption` (`L941`) | `function encodeLlmOption(provider, model)` | Encode provider/model pair into select option value. |
| `decodeLlmOption` (`L946`) | `function decodeLlmOption(value)` | Decode select option value into provider/model pair. |
| `getSelectedLlm` (`L956`) | `function getSelectedLlm()` | Return currently selected LLM pair, with safe default fallback. |
| `getSelectedLlmLabel` (`L964`) | `function getSelectedLlmLabel()` | Return user-facing label for current model selection. |
| `getSelectedOptionMeta` (`L970`) | `function getSelectedOptionMeta(options)` | Lookup metadata for the currently selected option in an options payload. |
| `loadLlmOptions` (`L976`) | `async function loadLlmOptions({ silent = false, forceProbe = false } = {})` | Fetch model options and render readiness-aware dropdown entries. |
| `ensureLlmFallbackOption` (`L1039`) | `function ensureLlmFallbackOption()` | Ensure selector still has at least one option when options API fails. |
| `renderDirectoryDropdown` (`L1052`) | `function renderDirectoryDropdown(payload)` | Render server-discovered ingestion folder suggestions for free-text input. |
| `loadDirectoryOptions` (`L1077`) | `async function loadDirectoryOptions({ silent = false } = {})` | Fetch valid ingestion folders and populate the directory dropdown. |
| `renderOntologyDropdown` (`L1108`) | `function renderOntologyDropdown(payload)` | Render server-discovered OWL file choices for ontology path input. |
| `loadOntologyOptions` (`L1132`) | `async function loadOntologyOptions({ silent = false } = {})` | Fetch available OWL paths and populate ontology dropdown options. |
| `setOntologyBrowserOpen` (`L1163`) | `function setOntologyBrowserOpen(open)` | Toggle ontology file browser modal visibility. |
| `renderOntologyBrowserRows` (`L1168`) | `function renderOntologyBrowserRows(title, items, kind)` | Build one directory/file section markup for ontology browser modal. |
| `renderOntologyBrowser` (`L1192`) | `function renderOntologyBrowser(payload)` | Render ontology file-browser directory and file rows from API payload. |
| `browseOntologyDirectory` (`L1211`) | `async function browseOntologyDirectory(path = '')` | Fetch one ontology directory level for modal browser navigation. |
| `openOntologyBrowser` (`L1218`) | `async function openOntologyBrowser()` | Open ontology file browser modal and load initial directory rows. |
| `handleOntologyBrowserListClick` (`L1224`) | `async function handleOntologyBrowserListClick(event)` | Handle click actions on ontology browser rows (navigate/select). |
| `getCaseUpdatedLabel` (`L1246`) | `function getCaseUpdatedLabel(item)` | Convert a case summary updated timestamp into a short UI label. |
| `normalizeCaseDirectory` (`L1258`) | `function normalizeCaseDirectory(caseSummary)` | Return saved folder path for a case summary, or empty string when unavailable. |
| `applyCaseSelection` (`L1263`) | `function applyCaseSelection(caseSummary)` | Apply selected case id and saved folder path into form controls. |
| `renderCaseIndex` (`L1276`) | `function renderCaseIndex()` | Render vertical case index list and highlight the active case id. |
| `loadCases` (`L1323`) | `async function loadCases({ silent = false } = {})` | Load all cases from CouchDB-backed API and refresh the vertical index. |
| `selectedLlmIsOperational` (`L1356`) | `function selectedLlmIsOperational()` | Return true only when currently selected option is enabled/operational. |
| `renderTimeline` (`L1362`) | `function renderTimeline()` | Render chronological timeline strip for all loaded depositions. |
| `renderDepositions` (`L1389`) | `function renderDepositions()` | Render score-ranked deposition cards in the risk list panel. |
| `getOverallShortAnswer` (`L1415`) | `function getOverallShortAnswer(dep)` | Build concise summary line from contradiction explanation and score. |
| `clearFocusedReasoning` (`L1427`) | `function clearFocusedReasoning()` | Reset focused contradiction reasoning panel state. |
| `renderDetail` (`L1434`) | `function renderDetail(dep)` | Render selected deposition details and clickable contradiction items. |
| `reasonAboutContradiction` (`L1477`) | `async function reasonAboutContradiction({ caseId, depositionId, contradiction })` | Call focused reasoning endpoint for one contradiction list item. |
| `addMessage` (`L1509`) | `function addMessage(role, content)` | Append a chat bubble and keep scroll anchored at latest message. |
| `resetChatForSelectedDeposition` (`L1518`) | `function resetChatForSelectedDeposition()` | Start a fresh assistant conversation whenever the active deposition changes. |
| `getDefaultDepositionId` (`L1525`) | `function getDefaultDepositionId()` | Pick default deposition id (highest score first) for chat/detail fallback selection. |
| `loadDepositions` (`L1534`) | `async function loadDepositions()` | Load and render all depositions for the active case id. |
| `refreshCase` (`L1587`) | `async function refreshCase()` | Clear all current deposition docs for the active case id. |
| `createBlankCase` (`L1610`) | `function createBlankCase()` | Reset form + panes so user can create a brand-new empty case. |
| `saveCase` (`L1621`) | `async function saveCase()` | Persist case metadata so it appears in the Case Index list. |
| `loadOntologyGraph` (`L1660`) | `async function loadOntologyGraph()` | Import OWL ontology files into Neo4j Graph RAG store. |
| `askGraphRag` (`L1687`) | `async function askGraphRag()` | Query ontology graph via backend Graph RAG endpoint and render answer/sources. |
| `openGraphBrowser` (`L1729`) | `async function openGraphBrowser()` | Open Neo4j Browser URL for graph inspection. |
| `deleteCaseById` (`L1744`) | `async function deleteCaseById(caseId)` | Delete one case id and refresh dependent UI state and data. |
| `selectDeposition` (`L1780`) | `async function selectDeposition(depositionId)` | Select a deposition and load full detail payload into detail panel. |
| `ingestCase` (`L1798`) | `async function ingestCase()` | Start full-case ingestion using selected provider/model selection. |
| `sendChat` (`L1845`) | `async function sendChat(event)` | Submit chat prompt and render assistant response into chat panel. |

## `mcp_servers/couchdb_server.py`

**Artifact purpose:** No module docstring present; see function-level details below.

| Function | Signature | Description |
| --- | --- | --- |
| `_settings` (`L25`) | `def _settings() -> tuple[str, str]` | Read CouchDB connection settings from environment. |
| `_with_client` (`L33`) | `def _with_client(fn)` | Execute a function with a managed ``CouchDBClient`` lifecycle. |
| `_doc_preview` (`L45`) | `def _doc_preview(doc: dict[str, Any]) -> dict[str, Any]` | Project full deposition docs into lightweight listing payloads. |
| `list_case_depositions` (`L61`) | `def list_case_depositions(case_id: str, limit: int=200) -> dict[str, Any]` | List deposition documents in a case, ranked by contradiction score. |
| `get_deposition` (`L76`) | `def get_deposition(deposition_id: str) -> dict[str, Any]` | Get full deposition document by id. |
| `list_flagged_depositions` (`L86`) | `def list_flagged_depositions(case_id: str, min_score: int=1) -> dict[str, Any]` | List flagged/contradictory depositions for a case. |
| `search_claims` (`L110`) | `def search_claims(case_id: str, query: str, limit: int=20) -> dict[str, Any]` | Search extracted claims by text match across witness statements in a case. |

## `mcp_servers/thought_stream_server.py`

**Artifact purpose:** No module docstring present; see function-level details below.

| Function | Signature | Description |
| --- | --- | --- |
| `_settings` (`L24`) | `def _settings() -> tuple[str, str]` | Read CouchDB URL and thought-stream DB from environment. |
| `_with_client` (`L32`) | `def _with_client(fn)` | Execute a function with a managed ``CouchDBClient`` lifecycle. |
| `_utc_now_iso` (`L44`) | `def _utc_now_iso() -> str` | Return current UTC timestamp in ISO-8601 format. |
| `_trace_doc_id` (`L50`) | `def _trace_doc_id(trace_id: str) -> str` | Build deterministic thought-stream document id from trace id. |
| `_normalize_status` (`L57`) | `def _normalize_status(status: str) -> Literal['running', 'completed', 'failed']` | Validate and normalize thought-stream status. |
| `_max_sequence` (`L66`) | `def _max_sequence(trace_payload: dict[str, Any]) -> int` | Return max assigned sequence across both trace channels. |
| `_coerce_events` (`L79`) | `def _coerce_events(events: list[dict[str, Any]] \| None) -> list[dict[str, Any]]` | Defensively normalize event list values into dict items. |
| `_load_stream_doc` (`L92`) | `def _load_stream_doc(client: CouchDBClient, trace_id: str) -> dict[str, Any]` | Load one thought-stream document or create an empty base payload. |
| `thought_stream_health` (`L134`) | `def thought_stream_health() -> dict[str, Any]` | Check thought-stream CouchDB connectivity and report active database. |
| `append_thought_stream_events` (`L150`) | `def append_thought_stream_events(trace_id: str, legal_clerk: list[dict[str, Any]] \| None=None, attorney: list[dict[str, Any]] \| None=None, status: str='running', case_id: str \| None=None) -> dict[str, Any]` | Append legal-clerk/attorney events to one thought-stream document. |
| `get_thought_stream` (`L211`) | `def get_thought_stream(trace_id: str) -> dict[str, Any]` | Get one thought-stream document by trace id. |
| `list_thought_streams` (`L239`) | `def list_thought_streams(case_id: str \| None=None, limit: int=100) -> dict[str, Any]` | List thought-stream documents, optionally filtered by case id. |
| `delete_thought_stream` (`L273`) | `def delete_thought_stream(trace_id: str) -> dict[str, Any]` | Delete one thought-stream document by trace id. |

## `scripts/generate_internal_docs.py`

**Artifact purpose:** No module docstring present; see function-level details below.

| Function | Signature | Description |
| --- | --- | --- |
| `_normalize_text` (`L45`) | `def _normalize_text(value: str) -> str` | Collapse whitespace/newlines to one readable sentence-style string. |
| `_safe_sentence_from_name` (`L51`) | `def _safe_sentence_from_name(name: str) -> str` | Return fallback description text from a function name. |
| `_iter_python_files` (`L60`) | `def _iter_python_files() -> list[Path]` | Return sorted Python files from configured targets. |
| `_module_summary` (`L74`) | `def _module_summary(tree: ast.Module) -> str` | Extract module-level summary from module docstring when available. |
| `_py_signature` (`L84`) | `def _py_signature(node: ast.FunctionDef \| ast.AsyncFunctionDef, qualified_name: str) -> str` | Build a readable Python function signature string from AST fields. |
| `_FunctionCollector.__init__` (`L98`) | `def _FunctionCollector.__init__(self) -> None` | Internal helper that handles function collector in   init. |
| `_FunctionCollector._push` (`L102`) | `def _FunctionCollector._push(self, value: str) -> None` | Internal helper that handles function collector in  push. |
| `_FunctionCollector._pop` (`L105`) | `def _FunctionCollector._pop(self) -> None` | Internal helper that handles function collector in  pop. |
| `_FunctionCollector.visit_ClassDef` (`L109`) | `def _FunctionCollector.visit_ClassDef(self, node: ast.ClassDef) -> None` | Internal helper that handles function collector in visit  class def. |
| `_FunctionCollector.visit_FunctionDef` (`L114`) | `def _FunctionCollector.visit_FunctionDef(self, node: ast.FunctionDef) -> None` | Internal helper that handles function collector in visit  function def. |
| `_FunctionCollector.visit_AsyncFunctionDef` (`L117`) | `def _FunctionCollector.visit_AsyncFunctionDef(self, node: ast.AsyncFunctionDef) -> None` | Internal helper that handles function collector in visit  async function def. |
| `_FunctionCollector._record` (`L120`) | `def _FunctionCollector._record(self, node: ast.FunctionDef \| ast.AsyncFunctionDef) -> None` | Internal helper that handles function collector in  record. |
| `_collect_python_functions` (`L133`) | `def _collect_python_functions(tree: ast.Module) -> list[tuple[ast.FunctionDef \| ast.AsyncFunctionDef, str]]` | Return top-level functions and class methods in stable source order. |
| `_document_python_file` (`L141`) | `def _document_python_file(path: Path) -> ArtifactDoc` | Extract module and function documentation from one Python source file. |
| `_extract_js_module_summary` (`L164`) | `def _extract_js_module_summary(lines: list[str]) -> str` | Return top-of-file JS block comment as artifact summary. |
| `_extract_js_function_comment` (`L176`) | `def _extract_js_function_comment(lines: list[str], start_index: int) -> str` | Extract in-function leading comment block when present. |
| `_document_js_file` (`L209`) | `def _document_js_file(path: Path) -> ArtifactDoc` | Extract function signatures and comments from one JavaScript file. |
| `_collect_artifacts` (`L237`) | `def _collect_artifacts() -> list[ArtifactDoc]` | Build complete artifact/function documentation data structure. |
| `_render_markdown` (`L249`) | `def _render_markdown(artifacts: list[ArtifactDoc]) -> str` | Render artifact and function documentation into markdown text. |
| `main` (`L302`) | `def main() -> None` | Generate and write the internal documentation markdown artifact. |

## `scripts/generate_uml_diagrams.py`

**Artifact purpose:** No module docstring present; see function-level details below.

| Function | Signature | Description |
| --- | --- | --- |
| `draw_title` (`L24`) | `def draw_title(draw: ImageDraw.ImageDraw, title: str, subtitle: str='') -> None` | Draw top heading and optional subtitle text for one diagram canvas. |
| `participant_centers` (`L32`) | `def participant_centers(width: int, participants: list[str], margin: int=90) -> list[int]` | Compute evenly spaced X positions for sequence-diagram participants. |
| `draw_participants` (`L42`) | `def draw_participants(draw: ImageDraw.ImageDraw, participants: list[str], xs: list[int], head_y: int, lane_top: int, lane_bottom: int) -> None` | Render participant swimlane headers and dashed vertical lifelines. |
| `arrow_head` (`L62`) | `def arrow_head(draw: ImageDraw.ImageDraw, end: tuple[int, int], direction: int, color: str) -> None` | Render triangular arrow head at the message endpoint. |
| `draw_message` (`L78`) | `def draw_message(draw: ImageDraw.ImageDraw, x1: int, x2: int, y: int, text: str, dashed: bool=False, color: str='#0F172A') -> None` | Draw one message line (solid or dashed) plus labeled annotation box. |
| `sequence_diagram` (`L109`) | `def sequence_diagram(filename: str, title: str, subtitle: str, participants: list[str], messages: list[tuple[str, str, str, bool]], width: int=2200, height: int=1400) -> None` | Render and write one complete sequence diagram image file. |
| `startup_sequence` (`L144`) | `def startup_sequence() -> None` | Generate startup-readiness sequence diagram PNG. |
| `ingest_sequence` (`L165`) | `def ingest_sequence() -> None` | Generate ingestion workflow sequence diagram PNG. |
| `chat_sequence` (`L190`) | `def chat_sequence() -> None` | Generate attorney-chat sequence diagram PNG. |
| `reason_sequence` (`L214`) | `def reason_sequence() -> None` | Generate focused contradiction reasoning sequence diagram PNG. |
| `main` (`L238`) | `def main() -> None` | Regenerate all UML sequence diagram assets under docs/uml. |

## `scripts/use_couchdb_mcp.py`

**Artifact purpose:** No module docstring present; see function-level details below.

| Function | Signature | Description |
| --- | --- | --- |
| `_extract_text` (`L14`) | `def _extract_text(result) -> str` | Concatenate text fragments from MCP tool call results. |
| `main` (`L25`) | `async def main() -> None` | Connect to local MCP server script and run a small tool sequence. |

## `scripts/use_thought_stream_mcp.py`

**Artifact purpose:** No module docstring present; see function-level details below.

| Function | Signature | Description |
| --- | --- | --- |
| `_extract_text` (`L14`) | `def _extract_text(result) -> str` | Concatenate text fragments from MCP tool call results. |
| `main` (`L25`) | `async def main() -> None` | Connect to local thought-stream MCP server and run a small tool sequence. |
