services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: deposition-api
    environment:
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      MODEL_NAME: ${MODEL_NAME:-gpt-5.2}
      OPENAI_MODELS: ${OPENAI_MODELS:-gpt-5.2}
      DEFAULT_LLM_PROVIDER: ${DEFAULT_LLM_PROVIDER:-openai}
      OLLAMA_URL: ${OLLAMA_URL:-http://host.docker.internal:11434}
      OLLAMA_DEFAULT_MODEL: ${OLLAMA_DEFAULT_MODEL:-llama3.3:latest}
      OLLAMA_MODELS: ${OLLAMA_MODELS:-llama3.3:latest}
      COUCHDB_URL: http://admin:password@couchdb:5984
      COUCHDB_DB: ${COUCHDB_DB:-depositions}
      MAX_CONTEXT_DEPOSITIONS: ${MAX_CONTEXT_DEPOSITIONS:-20}
    ports:
      - "${API_PORT:-8000}:8000"
    depends_on:
      - couchdb
    volumes:
      - ${DEPOSITION_DIR:-./sample_depositions}:/data/depositions:ro

  couchdb:
    image: couchdb:3
    container_name: deposition-couchdb
    ports:
      - "${COUCHDB_PORT:-5984}:5984"
    environment:
      COUCHDB_USER: admin
      COUCHDB_PASSWORD: password
    volumes:
      - couchdb_data:/opt/couchdb/data

volumes:
  couchdb_data:
